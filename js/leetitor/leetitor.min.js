function elem(a){try{return document.getElementById(a)||document.all[a]}catch(e){return false}}function addEvent(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent('on'+b,c)}function getTarget(e){var e=e||window.event;return e.target||e.srcElement}function getOffsetTop(a){var b=a.offsetTop,off_parent=a.offsetParent;while(off_parent){b+=off_parent.offsetTop;off_parent=off_parent.offsetParent}return b}function getOffsetLeft(a){var b=a.offsetLeft,off_parent=a.offsetParent;while(off_parent){b+=off_parent.offsetLeft;off_parent=off_parent.offsetParent}return b}function selection(a,b){if(a.getSelection)return a.getSelection();else if(b.selection)return b.selection}function toRange(a){if(a.getRangeAt)return a.getRangeAt(0);else if(document.selection)return a.createRange();else{var b=document.createRange();b.setStart(a.anchorNode,a.anchorOffset);b.setEnd(a.focusNode,a.focusOffset);return b}}var leetitor={base_src:'',init:function(){var a=document.getElementsByTagName('textarea'),t,new_id,editor_frame,inputs,n;for(t=0;t<a.length;t++){if(a[t].className.indexOf('editable')>=0){a[t].style.display='none';new_id=a[t].id+'_editable';editor_frame=document.createElement('iframe');editor_frame.setAttribute('id',new_id);editor_frame.setAttribute('name',new_id);editor_frame.className='leetitor';editor_frame.setAttribute('src',leetitor.base_src+'leetitor/leetitor.html?element='+a[t].id);if(document.all)editor_frame.frameBorder=0;editor_frame.style.width='100%';editor_frame.style.height='380px';editor_frame.style.border='1px solid #000';a[t].parentNode.appendChild(editor_frame);inputs=a[t].parentNode.getElementsByTagName('input');for(n=0;n<inputs.length;n++){if(inputs[n].type=='submit'&&inputs[n].className.indexOf('no-hide')<0){inputs[n].style.display='none'}}a[t].className=a[t].className.replace('editable','')}}},id:null,doc:null,win:null,settings:[],sizes:[1,2,3,4,5,6,7],sizes_locale:['7.5pt','10pt','12pt','13.5pt','18pt','24pt','36pt'],color_state:0,color_btn:null,dropcmd:null,dropmenu:null,source:false,start:function(){var a=leetitor,search=window.location.search,settings,s,parts,style_selector,style_menu,f,stle,cls,format_selector,format_menu,format,fontname_selector,fontname_menu,fo,font,fontsize_selector,fontsize_menu,size,e;a.id=search.substring(search.indexOf('element=')+8,search.length);if(document.all)elem('editor').frameBorder=2;settings=parent.elem(a.id+'_settings').value;settings=settings.split(';');for(s in settings){parts=settings[s].split('=');a.settings[parts[0]]=parts[1]}if(a.settings['style']=='true'){style_selector=elem('selector_style');style_selector.style.display='block';style_menu=elem('menu_style');style_menu.style.top=getOffsetTop(style_selector)+20+'px';style_menu.style.left=getOffsetLeft(style_selector)+'px';for(f in a.styles){stle=document.createElement('div');cls=a.styles[f][2];cls=(cls=='')?'nothing':cls;stle.className='dropitem style_'+f+' '+cls;stle.appendChild(document.createTextNode(a.styles[f][0]));style_menu.appendChild(stle)}}if(a.settings['format']=='true'){format_selector=elem('selector_formatblock');format_selector.style.display='block';format_menu=elem('menu_formatblock');format_menu.style.top=getOffsetTop(format_selector)+20+'px';format_menu.style.left=getOffsetLeft(format_selector)+'px';for(f in a.formats){format=document.createElement('div');format.className='dropitem '+a.formats[f];format.appendChild(document.createTextNode(a.formats_locale[f]));format_menu.appendChild(format)}}if(a.settings['font']=='true'){fontname_selector=elem('selector_fontname');fontname_selector.style.display='block';fontname_menu=elem('menu_fontname');fontname_menu.style.top=getOffsetTop(fontname_selector)+20+'px';fontname_menu.style.left=getOffsetLeft(fontname_selector)+'px';for(f in a.fonts){fo=a.fonts[f];font=document.createElement('div');font.className='dropitem '+fo;font.style.fontFamily=fo;font.appendChild(document.createTextNode(fo));fontname_menu.appendChild(font)}fontsize_selector=elem('selector_fontsize');fontsize_selector.style.display='block';fontsize_menu=elem('menu_fontsize');fontsize_menu.style.top=getOffsetTop(fontsize_selector)+20+'px';fontsize_menu.style.left=getOffsetLeft(fontsize_selector)+'px';for(f in a.sizes){s=a.sizes_locale[f];size=document.createElement('div');size.className='dropitem '+a.sizes[f];size.style.fontSize=s;size.appendChild(document.createTextNode(s));fontsize_menu.appendChild(size)}}if(a.settings['colors']=='false'){elem('forecolor').style.display='none';elem('hilitecolor').style.display='none'}if(a.settings['link']=='false')elem('createlink').style.display='none';if(a.settings['table']=='false')elem('inserttable').style.display='none';a.makeEditable(true);if(document.all){for(e=0;e<document.all.length;e++)document.all(e).unselectable='on';document.all['editor'].unselectable='off'}},makeEditable:function(a){var b=leetitor;b.doc=elem('editor').contentDocument;b.win=elem('editor').contentWindow;if(typeof b.doc=='undefined')b.doc=b.win.document;b.doc.designMode='on';window.setTimeout(function(){b.doc.body.innerHTML=(a)?parent.elem(b.id).value:'';if(navigator.userAgent.indexOf('Gecko')>-1){b.doc.designMode='off';b.doc.designMode='on'}if(a){addEvent(document.body,'click',b.click);addEvent(window.frames['editor'].document.body,'click',b.click);addEvent(b.doc,'keyup',b.senseFormats);addEvent(b.doc,'keydown',b.keys)}},0)},click:function(e){var a=getTarget(e),btn_cmd,leet=leetitor;if(a.nodeName.toLowerCase()=='button'&&a.className.indexOf('cmd')==0){btn_cmd=a.id;if(btn_cmd=='save')leet.save();else if(btn_cmd=='source')leet.switchSource();else if(btn_cmd=='attr_editor'&&!leet.source)leet.openWin('dialog_attr_editor.html','dialog_attr_editor',500,400);else if(btn_cmd=='createlink'&&!leet.source)leet.openWin('dialog_createlink.html','dialog_createlink',400,150);else if(btn_cmd=='insertimage'&&!leet.source)leet.openWin('dialog_insertimage.html','dialog_insertimage',400,150);else if(btn_cmd=='inserttable'&&!leet.source)leet.openWin('dialog_inserttable.html','dialog_inserttable',350,450);else if(btn_cmd.indexOf('color')>0&&!leet.source){leet.color(btn_cmd,a);return}else if(!leet.source)leet.format(btn_cmd)}if(a.nodeName.toLowerCase()=='div'&&a.id.indexOf('selector_')==0&&!leet.source)leet.dropdown(a.id.substring(9,30),a);else if(a.className.indexOf('dropdown_')<0)leet.dropdown(null,null);if(a.className.indexOf('dropitem')==0&&!leet.source)leet.advFormat(a);if(a.parentNode.id!='colorpalette')leet.color(null,a);else if(a.parentNode.id=='colorpalette'&&!leet.source)leet.formatColor(a.style.backgroundColor);leet.senseFormats()},keys:function(e){var a=e.keyCode,leet=leetitor;if((e.ctrlKey&&a==86)&&!leet.source){window.setTimeout(function(){leet.doc.body.innerHTML=leet.paste()},1)}},save:function(){if(leetitor.source){alert(leetitor.lang['err_save_source']);return false}var a=leetitor.paste(),tarea=parent.elem(leetitor.id),parent_tarea=tarea.parentNode,leet=leetitor;a=leet.fixMarkup(a);tarea.value=a;if(leet.settings['save']=='submit'){while(parent_tarea.nodeName.toLowerCase()!='form')parent_tarea=parent_tarea.parentNode;parent_tarea.submit()}else{parent.LeetitorSaveDoc()}},format:function(a){try{leetitor.doc.execCommand(a,false,null)}catch(e){alert(leetitor.lang['err_format_support1']+a+leetitor.lang['err_format_support2'])}leetitor.focus()},advFormat:function(a){var b=a.parentNode.id.substring(5,30),value=a.className.substring(9,40),leet=leetitor;if(b=='style')return leet.styleFormat(a);if(b=='formatblock')value='<'+value+'>';try{leet.doc.execCommand(b,false,value)}catch(e){alert(leet.lang['err_format_support1']+b+leet.lang['err_format_support2'])}leet.focus()},styleFormat:function(a){var b=a.className.substring(15,18);b=b.substring(0,b.indexOf(' '));var c=leetitor,stle=c.styles[b],sel=selection(c.win,c.doc),range=toRange(sel),sel_frag,new_elem,li,cls,html,new_elem;if(window.getSelection){if(!sel.toString().length)return;sel_frag=range.extractContents()||document.createDocumentFragment();new_elem=document.createElement(stle[1]);if(stle[2]!='')new_elem.className=stle[2];if(stle[1]=='ul'||stle[1]=='ol'){li=document.createElement('li');li.appendChild(sel_frag);new_elem.appendChild(li)}else new_elem.appendChild(sel_frag);range.insertNode(new_elem);range.detach()}else{if(!range.text.length)return;cls=(stle[2]=='')?'':' class="'+stle[2]+'"';html=range.htmlText;if(stle[1]=='ul'||stle[1]=='ol')html='<li>'+range.htmlText+'</li>';new_elem='<'+stle[1]+cls+'>'+html+'</'+stle[1]+'>';range.pasteHTML(new_elem)}c.focus()},formatColor:function(a){var b=leetitor,cmd=b.color_btn.id;if(cmd=='hilitecolor'&&document.all)cmd='backcolor';b.doc.execCommand(cmd,false,a);b.color(null,null)},color:function(a,b){var c=leetitor;if(c.color_btn!=null)c.color_btn.className=c.color_btn.className.replace('active','');if(a==null){elem('colorpalette').style.display='none';c.color_state=false}else{var d=b.className;b.className+=(d.substring(d.length-1,d.length)==' ')?'active':' active';with(elem('colorpalette').style){top=getOffsetTop(b)+20+'px';left=getOffsetLeft(b)+'px';display='block'}c.color_btn=b;c.color_state=true;c.focus()}},senseFormats:function(a){if(leetitor.source)return false;var c=leetitor,sel=selection(c.win,c.doc),a=(document.selection)?sel.createRange().parentElement():sel.focusNode.parentNode,btns,b,f;btns=document.getElementsByTagName('button');for(b=0;b<btns.length;b++)btns[b].className=btns[b].className.replace(/active/g,'');if(c.settings['style']=='true')elem('selector_style').firstChild.nodeValue='Stil';if(c.settings['format']=='true')elem('selector_formatblock').firstChild.nodeValue='Format';if(c.settings['font']=='true'){elem('selector_fontname').firstChild.nodeValue='Teckensnitt';elem('selector_fontsize').firstChild.nodeValue='Storlek'}while(a.nodeName.toLowerCase()!='body'&&a.nodeName!='#document'){nn=a.nodeName.toLowerCase();if(nn=='strong'||nn=='b'||a.style.fontWeight=='bold')elem('bold').className+=' active';if(nn=='em'||nn=='i'||a.style.fontStyle=='italic')elem('italic').className+=' active';if(nn=='u'||a.style.textDecoration=='underline')elem('underline').className+=' active';if(a.style&&a.style.textAlign=='center')elem('justifycenter').className+=' active';else if(a.style&&a.style.textAlign=='right')elem('justifyright').className+=' active';else if(a.style&&a.style.textAlign=='justify')elem('justifyfull').className+=' active';else if(a.style&&a.style.textAlign=='left')elem('justifyleft').className+=' active';if(nn=='ul')elem('insertunorderedlist').className+=' active';else if(nn=='ol')elem('insertorderedlist').className+=' active';if(c.settings['style']=='true'){for(f=0;f<c.styles.length;f++){if(c.styles[f][1]==nn&&a.className==c.styles[f][2])elem('selector_style').firstChild.nodeValue=c.styles[f][0]}}if(c.settings['format']=='true'){for(f=0;f<c.formats.length;f++){if(c.formats[f]==nn)elem('selector_formatblock').firstChild.nodeValue=c.formats_locale[f]}}if(c.settings['font']=='true'){if(a.style&&a.style.fontFamily)elem('selector_fontname').firstChild.nodeValue=a.style.fontFamily;if(nn=='font'&&a.getAttribute('face'))elem('selector_fontname').firstChild.nodeValue=a.getAttribute('face');for(var f=0;f<c.sizes.length;f++){if(nn=='font'&&a.getAttribute('size')==c.sizes[f])elem('selector_fontsize').firstChild.nodeValue=c.sizes_locale[f]}}a=a.parentNode}},paste:function(){var a=leetitor.doc.body.innerHTML;a=a.replace(/<style.*?>(.*?)<\/style>/ig,'');a=a.replace(/<.*?Mso.*?>(.*?)<\/.*?>/ig,'$1');a=a.replace(/<br style=".*?">/ig,'<br />\n');a=a.replace(/<(.*?) align="(.*?)">/ig,'<$1>');if(leetitor.settings['semantic']=='true'){a=a.replace(/<font.*?>(.*?)<\/font>/ig,'$1');a=a.replace(/<span style="font-weight: bold;">(.*?)<\/span>/ig,'<strong>$1</strong>');a=a.replace(/<span style="font-style: italic;">(.*?)<\/span>/ig,'<em>$1</em>');a=a.replace(/<img(.*?)>/ig,'<img$1 />')}return a},fixMarkup:function(e){e=e.replace(/<br>/ig,'<br />\n');e=e.replace(/(\w+)(=+)(\w+)(\s+|\/|>)+/g,'$1$2"$3"$4');e=e.replace(/<\/?(\w+)((?:[^'">]*|'[^']*'|"[^"]*")*)>/g,tagToLower);function tagToLower(a,b,c){b=b.toLowerCase();var d=(a.match(/^<\//));if(d)a='</'+b+'>';else a='<'+b+c+'>';return a}return e},dropdown:function(a,b){var c=leetitor;if(c.dropmenu!=null)elem('menu_'+c.dropcmd).style.display='none';if(a!=null){var d=b.className;elem('menu_'+a).style.display='block';c.dropmenu=b;c.dropcmd=a}else{c.dropmenu=null;c.dropcmd=null}},switchSource:function(){var a=leetitor,source_html,editor_html;if(a.source){try{source_html=a.doc.createRange();source_html.selectNodeContents(a.doc.body)}catch(e){source_html=a.doc.body.innerText}a.doc.body.innerHTML=source_html.toString();a.source=false}else{if(document.all){editor_html=a.doc.body.innerHTML;a.doc.body.innerText=editor_html}else{editor_html=document.createTextNode(a.doc.body.innerHTML);a.doc.body.innerHTML='';a.doc.body.appendChild(editor_html)}a.source=true}a.focus()},focus:function(){leetitor.win.focus()},openWin:function(a,b,c,d){var e=parseInt(screen.width/2-c/2),top=parseInt(screen.height/2-d/2);return window.open(a,b,'left='+e+',top='+top+',height='+d+',width='+c+',dependent=yes,dialog=yes,minimizable=no,scrollbars=yes')}};addEvent(window,'load',leetitor.init);