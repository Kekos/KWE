<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="sv" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>Infoga tabell - Leetitor</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link type="text/css" href="leetitor.css" rel="stylesheet" media="screen" />
  <script type="text/javascript" src="leetitor.min.js"></script>
  <script type="text/javascript" src="leetitor_settings.min.js"></script>
  <script type="text/javascript">// <![CDATA[
    var win = window.opener;
    var leetwin = win.leetitor;
    var sel = null;
    var elemt = null;
    var cell = null;
    var table = false;
    addEvent(window, 'load', function()
      {
      // Is a table already selected?
      sel = selection(leetwin.win, leetwin.doc);
      elemt = (document.selection) ? sel.createRange().parentElement() : sel.focusNode.parentNode;
      var nn = elemt.nodeName.toLowerCase();
      cell = elemt;

      while (elemt.nodeName.toLowerCase() != 'body' && elemt.nodeName != '#document')
        {
        if (elemt.nodeName.toLowerCase() == 'table')
          {
          table = true;
          break;
          }
        elemt = elemt.parentNode;
        }

      if (table)
        {
        elem('create_table').style.display = 'none';
        elem('attr_id').value = elemt.id;
        elem('attr_classname').value = elemt.className;
        }
      });

    addEvent(document, 'click', function(e)
      {
      var targ = getTarget(e);
      var id = targ.id;
      if (id == 'btn_ok')
        {
        if (table)
          {
          if (elem('attr_id').value != '')
            elemt.id = elem('attr_id').value;
          if (elem('attr_classname').value != '')
            elemt.className = elem('attr_classname').value;
          }
        else
          {
          var rows = elem('new_row').value;
          var cols = elem('new_col').value;
          if (!cols.match(/[0-9]/) || !cols.match(/[0-9]/) || cols == '' || rows == '')
            {
            alert(leetitor.lang['err_number_format']);
            return false;
            }

          var range = toRange(sel);
          if (window.getSelection)
            {
            if (!sel.toString().length)
              return;
            range.extractContents();

            var new_table = document.createElement('table');
            if (elem('attr_id').value != '')
              new_table.id = elem('attr_id').value;
            if (elem('attr_classname').value != '')
              new_table.className = elem('attr_classname').value;
            for (var r = 0; r < rows; r++)
              {
              var new_row = document.createElement('tr');
              for (var c = 0; c < cols; c++)
                {
                var new_col = document.createElement('td');
                new_col.appendChild(document.createTextNode(' '));
                new_row.appendChild(new_col);
                }
              new_table.appendChild(new_row);
              }
            range.insertNode(new_table);

            range.detach(); // Clean-up!
            }
          else
            {
            if (!range.text.length)
              return;
            var ids = (elem('attr_id').value == '') ? '' : ' id="' + elem('attr_id').value + '"';
            var cls = (elem('attr_classname').value == '') ? '' : ' class="' + elem('attr_classname').value + '"';
            var new_table = '<table' + ids + cls + '>\n';
            for (var r = 0; r < rows; r++)
              {
              new_table += '  <tr>\n';
              for (var c = 0; c < cols; c++)
                new_table += '    <td></td>\n';
              new_table += '  </tr>\n';
              }
            new_table += '</table>\n';
            range.pasteHTML(new_table);
            }
          }
        leetwin.focus();
        window.close();
        }
      else if (id == 'btn_cancel')
        window.close();
      });
  // ]]></script>
</head>

<body id="leetitor_dialog">

<h1>Infoga tabell</h1>

<fieldset id="create_table">
  <legend>Skapa tabell</legend>

  <div class="list">
    <div class="term">Antal rader:</div> <input type="text" id="new_row" class="def" />
    <div class="term">Antal kolumner:</div> <input type="text" id="new_col" class="def" />
  </div>
</fieldset>

<fieldset id="table_props">
  <legend>Tabellegenskaper</legend>

  <div class="list">
    <div class="term">ID</div> <input type="text" id="attr_id" class="def" value="" />
    <div class="term">CSS-klasser</div> <input type="text" id="attr_classname" class="def" value="" />
  </div>
</fieldset>

<div id="footer"><input type="button" value="OK" id="btn_ok" /> <input type="button" value="Avbryt" id="btn_cancel" /></div>

</body>

</html>