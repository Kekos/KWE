<?php
$page = (isset($this->request) ? $this->request->params[0] : '');
$data['stylesheets'] = array_unique($data['stylesheets']);
$data['scripts'] = array_unique($data['scripts']);

function menuLink($current_page, $new_page, $is_clink)
  {
  return '<a href="' . urlModr($new_page) . '" class="' . ($is_clink ? 'clink ' : '') . 'menu-item' . ($current_page == $new_page ? ' active' : '') . '">';
  }
?>
<!DOCTYPE html>
<html lang="sv">

<head>
  <title>KWE Admin :: <?php echo $this->title; ?></title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <link title="KWE Admin" href="<?php echo FULLPATH; ?>/css/kwe_admin<?php if (MINIFIED) echo '.min'; ?>.css" rel="stylesheet" media="screen" />
  <link href="<?php echo FULLPATH_SITE; ?>/js/domiwyg.min.css" rel="stylesheet" />
  <link href="<?php echo FULLPATH_SITE; ?>/css/site_domiwyg.css" rel="stylesheet" />
  <link href="<?php echo FULLPATH; ?>/css/kwe_admin_print<?php if (MINIFIED) echo '.min'; ?>.css" rel="stylesheet" media="print" />
<?php foreach ($data['stylesheets'] as $stylesheet): ?>
  <link href="<?php echo $stylesheet; ?>" rel="stylesheet" />
<?php endforeach; ?>
  <!--[if lte IE 7]><link href="<?php echo FULLPATH; ?>/css/kwe_admin_ie<?php if (MINIFIED) echo '.min'; ?>.css" rel="stylesheet" /><![endif]-->
  <!--[if lte IE 8]><script src="<?php echo FULLPATH_SITE; ?>/js/html5.min.js" type="text/javascript"></script><![endif]-->
  <script src="<?php echo FULLPATH_SITE; ?>/js/domiwyg.min.js"></script>
  <script src="<?php echo FULLPATH_SITE; ?>/js/domiwyg.swedish.min.js"></script>
<?php if (MINIFIED): ?>
  <script src="<?php echo FULLPATH_SITE; ?>/js/kwe.min.js"></script>
<?php else: ?>
  <script src="<?php echo FULLPATH_SITE; ?>/js/kwf.js"></script>
  <script src="<?php echo FULLPATH_SITE; ?>/js/kwe.js"></script>
<?php endif; ?>
<?php foreach ($data['scripts'] as $script): ?>
  <script src="<?php echo $script; ?>"></script>
<?php endforeach; ?>
  <script>Kwf.FULLPATH = '<?php echo FULLPATH; ?>'; Kwf.FULLPATH_SITE = '<?php echo FULLPATH_SITE; ?>';
    Kwf.MODR = '<?php echo urlModr(); ?>'; Kwf.MODR_SITE = '<?php echo urlModrSite(); ?>';</script>
</head>

<body id="kwe_<?php if (isset($data['body_id'])) echo $data['body_id']; else echo 'default'; ?>">

<header id="header">
  <div id="header_inner">
    <h1><a href="<?php echo urlModr(); ?>" id="kwe_logo">KWE</a></h1>

    <nav id="navigation">
      <a href="<?php echo FULLPATH_SITE; ?>/" id="goto_firstpage" title="<?php echo __('HEADER_FIRSTPAGE'); ?>"><?php echo __('HEADER_FIRSTPAGE'); ?></a>

      <ul>
<?php if (Access::$is_logged_in): ?>
        <li><?php echo menuLink($page, 'index', true); ?><?php echo __('HEADER_DASHBOARD'); ?></a></li>
        <li><?php echo menuLink($page, 'page', true); ?><?php echo __('HEADER_PAGES'); ?></a></li>
        <li class="submenu-link"><?php echo menuLink($page, 'controllers', true); ?><?php echo __('HEADER_MODULES'); ?></a>
<?php
$controllers = $this->request->session->get('controllers');
if ($controllers): ?>
          <ul class="submenu">
<?php foreach ($controllers as $controller): ?>
            <li><a href="<?php echo urlModr($controller[1]); ?>" class="clink submenu-item"><?php echo $controller[0]; ?></a></li>
<?php endforeach; ?>
          </ul><?php endif; ?></li>
<?php if (Access::$user->rank == 1): ?>
        <li><?php echo menuLink($page, 'settings', true); ?><?php echo __('HEADER_SETTINGS'); ?></a></li>
        <li><?php echo menuLink($page, 'users', true); ?><?php echo __('HEADER_USERS'); ?></a></li>
<?php endif; ?>
        <li><?php echo menuLink($page, 'logout', false); ?><?php echo __('HEADER_LOGOUT'); ?></a></li>
<?php else: ?>
        <li><?php echo menuLink($page, 'index', false); ?><?php echo __('HEADER_LOGIN'); ?></a></li>
<?php endif; ?>
      </ul>
    </nav>
  </div>
</header>

<div id="page">
<?php if (count($this->error_messages)): ?>
  <ul id="errorlist">
<?php foreach ($this->error_messages as $msg): ?>
    <li><?php echo $msg; ?></li>
<?php endforeach; ?>
  </ul>
<?php endif; 

if (count($this->info_messages)): ?>
  <ul id="infolist">
<?php foreach ($this->info_messages as $msg): ?>
    <li><?php echo $msg; ?></li>
<?php endforeach; ?>
  </ul>
<?php endif; ?>

  <div id="content">

<?php echo $this->content_data; ?>

  </div>

  <footer id="footer">
    <p id="version"><?php echo KWE_VERSION; ?></p>
    <p id="copyright"><?php echo __('FOOTER_COPYRIGHT', '<a href="http://kekos.se/">Christoffer Lindahl</a>', '2009-2012'); ?></p>
    <p id="user-info"><?php if (Access::$is_logged_in): ?><?php echo __('FOOTER_LOGGED_IN_AS'); ?> <?php echo Access::$user->name; ?> <a href="<?php echo urlModr('change-password'); ?>" class="blink dim500x300">(<?php echo __('FOOTER_CHANGE_PW'); ?>)</a><?php endif; ?></p>
  </footer>
</div>

</body>

</html>